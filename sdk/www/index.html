<html>
<head>
  <title>Signing State Machines</title>
</head>

<script src="crypto-js/crypto-js.js"></script>
<script src="jsencrypt/jsencrypt.js"></script>

<script src="bcc-xmlhttp.js"></script>
<script src="ssm-api.js"></script>
<script type="text/javascript">

function logResult(result) {
	document.getElementById('data__Fld').value = JSON.stringify(JSON.parse(result),null,2);
}

function logSignature() {
	var txt = document.getElementById('txt__Fld').value;
	var prv = document.getElementById('prv__Fld').value;
	var JSE = new JSEncrypt();
	JSE.setPrivateKey(prv);
	var sgn = JSE.sign(txt, CryptoJS.SHA256, "sha256");
	document.getElementById('sgn__Log').innerHTML = sgn;
}

function logPublicKey() {
	var prv = document.getElementById('prv__Fld').value;
	var JSE = new JSEncrypt();
	JSE.setPrivateKey(prv);
	var pub = JSE.getPublicKey();
	document.getElementById('pub__Fld').value = pub;
}

function genPrivateKey() {
	var JSE = new JSEncrypt({default_key_size: 2048});
	var prv = JSE.getPrivateKey(prv);
	document.getElementById('prv__Fld').value = prv;
}

function ssmQuerySetup() {
	var uri = "http://" + document.getElementById('host__Fld').value + ":" + document.getElementById('port__Fld').value;
	var fcn = document.getElementById('query__Sel').value;
	var queryId = document.getElementById('query__Fld').value;
	var hostCmd = ssmQuery(fcn, queryId);
	bccHostCmd(uri, hostCmd.cmd, hostCmd.fcn, hostCmd.args, logResult, logResult);
}



</script>

<body>

<center><h1>Signing State Machines</h1></center>

<h2>Host gateway</h2>
Host address <input type="text" size="12" value="127.0.0.1" id="host__Fld">:<input type="text" size="6" value="8080" id="port__Fld">

<table>
<tr>
<td>
<h2>Private key</h2>
<textarea rows="28" cols="64" id="prv__Fld">
</textarea>
<br>
<input type="button" value="generate" onclick="genPrivateKey()"/>
<input type="button" value="public" onclick="logPublicKey()"/>
</td>
<td>
<input type="button" value="query" onclick="ssmQuerySetup()"/>
<select id="query__Sel">
  <option value="admin" selected>Admin</option>
  <option value="user">User</option>
  <option value="ssm">SSM</option>
  <option value="session">Session</option>
</select>
<input type="text" size="12" id="query__Fld"/>


<ul>
<li><b>Agent </b><input type="text" size="12" id="agent__Fld">
<li><b>Action </b><input type="text" size="12" id="action__Fld">
</ul>
<h3>Data</h3>
<textarea rows="16" cols="32" id="data__Fld">
</textarea>
<br>

</td>
</tr>
</table>

<h2>Public key</h2>
<textarea rows="8" cols="64" id="pub__Fld">
</textarea>

<h2>Text to sign</h2>
<textarea rows="8" cols="64" id="txt__Fld">
</textarea>
<br>
<input type="button" value="sign" onclick="logSignature()"/>

<h2>Signature</h2>
<pre id="sgn__Log">
</pre>

</body>
</html>
